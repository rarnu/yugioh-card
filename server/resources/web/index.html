<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/ygo.css">
    <script src="../static/js/jquery-2.0.0.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/js.cookie.min.js"></script>
    <script src="../static/ygo.js"></script>

    <script type="text/javascript">
        function search() {
            let key = $('#etKeyword')[0].value;
            Cookies.set('keyword', key);
            location.href = '/cardlist.html';
        }
        function advanced() {
            $('#advdialog').modal('toggle');
        }
        function deck() {
            location.href = "/deck.html";
        }

        function getHotest() {
            $.ajax({
                url: '/hotest',
                dataType: 'json',
                success: function (response) {
                    if (response.result === 0) {
                        // hot words
                        let strSearch = '';
                        $.each(response.search, function (idx, item) {
                            strSearch += `<div class="item" onclick="hotwordClicked('${item}');">${item}</div>`;
                            if (idx % 5 === 4) {
                                strSearch += '<br/>';
                            }
                        });
                        strSearch += '<br/>';
                        $('#hotwords')[0].innerHTML = strSearch;

                        // hot cards
                        let strCard = '';
                        $.each(response.card, function (idx, item) {
                            strCard += `<div class="item" onclick="hotcardClicked('${item.hashid}');">${item.name}</div>`;
                        });
                        $('#hotcards')[0].innerHTML = strCard;

                        // hot packs
                        let strPack = '';
                        $.each(response.pack, function (idx, item) {
                            strPack += `<div class="item" onclick="hotpackClicked('${item.packid}');">${item.name}</div>`;
                        });
                        $('#hotpacks')[0].innerHTML = strPack;
                    }
                }
            });
        }

        function hotwordClicked(w) {
            Cookies.set('keyword', w);
            location.href = '/cardlist.html';
        }

        function hotcardClicked(h) {
            Cookies.set('hashid', h);
            location.href = '/carddetail.html';
        }
        function hotpackClicked(u) {
            Cookies.set('packurl', u);
            location.href = '/packcards.html';
        }
        
        function changeHotestClicked() {
            getHotest();
        }
    </script>
</head>
<body>
<div id="title">
    <img id="logo" src="../static/image/logo.png">
    <br/>
    <span id="text">YuGiOh Card</span>
</div>

<div id="searchbar">
    <div class="input-group mb-3">
        <input id="etKeyword" type="text" class="form-control" placeholder="输入要搜索的关键字">
        <div class="input-group-append">
            <span class="input-group-text" onclick='search()' >Go</span>
            <span class="input-group-text" onclick="advanced()">Adv</span>
            <span class="input-group-text" onclick="deck()">Deck</span>
        </div>
    </div>
</div>
<div id="limitbar">
    <a href="limit.html"><span class="btnlimit">禁限卡表</span></a>
    <a href="pack.html"><span class="btnlimit">卡包列表</span></a>
</div>

<div class="line"></div>
<div class="hottitle">热门搜索</div>
<div id="hotwords"></div>
<div class="line"></div>
<div class="hottitle">热门卡片<div style="float: right" onclick="changeHotestClicked();">&lt;<u>换一批</u>&gt;</div></div>
<div id="hotcards"></div>
<div class="line"></div>
<div class="hottitle">热门卡包</div>
<div id="hotpacks"></div>
<div class="line"></div>

<div id="advsearch"></div>

<script type="text/javascript">
    $("#advsearch").load("popup/advance.html");

    $('#etKeyword').bind('keypress', function (event) {
        if (event.keyCode === 13) {
            search();
        }
    });
    getHotest();
</script>
</body>
</html>