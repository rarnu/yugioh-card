<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/toastr.min.css">
    <link rel="stylesheet" href="../static/ygo.css">
    <script src="../static/js/jquery-2.0.0.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/js.cookie.min.js"></script>
    <script src="../static/js/md5.js"></script>
    <script src="../static/js/toastr.min.js"></script>
    <script src="../static/ygo.js"></script>

    <script type="text/javascript">
        function loginDialog() {
            $("#logindialog").modal('toggle');
        }
        function registerDialog() {
            $("#registerdialog").modal('toggle');
        }
        function getUserData() {
            $.ajax({
                url: '/getuser',
                dataType: 'json',
                type: 'GET',
                success: function (resp) {
                    if (resp.id === 0) {
                        $("#divLoginReg")[0].style.display = "inline";
                        $("#divUserInfo")[0].style.display = "none";
                    } else {
                        $("#divLoginReg")[0].style.display = "none";
                        $("#divUserInfo")[0].style.display = "inline";
                        $("#spNickname")[0].innerHTML = `${resp.nickname} (${resp.account})`;
                        $("#spEmail")[0].innerHTML = resp.email;
                        $("#imgHead").attr('src','/gethead?id=' + Math.random());
                    }
                }
            });
        }
        function logout() {
            $.ajax({
                url: '/logout',
                type: 'GET',
                dataType: 'json',
                success: function (resp) {
                    getUserData();
                }
            });
        }
        function changeuserinfoDialog() {
            getOldData();
            $("#changeinfodialog").modal('toggle');
        }

    </script>
</head>
<body>

<div id="subtitle">
    <a href="javascript:history.go(-1)" id="backlink">◄ Back</a>
    <span id="title">我的卡片</span>
</div>

<div id="cardlist">
    <div id="divLoginReg" name="divLoginReg">
        <p></p>
        <p>你还没有登录，登录后可以查看自己的信息与收藏卡片等。</p>
        <p></p>
        <div>
            <button class="btnlimit" onclick="loginDialog();">老用户 登录</button>
            <button class="btnlimit" onclick="registerDialog();">新用户 注册</button>
        </div>
    </div>
    <div id="divUserInfo">
        <p></p>
        <table id="userinfo">
            <tr>
                <td rowspan="2" style="width: 80px;"><img id="imgHead" name="imgHead" src="../static/image/logo.png" class="userhead"></td>
                <td><span id="spNickname" name="spNickname"></span></td>
            </tr>
            <tr>
                <td><span id="spEmail" name="spEmail" class="useremail"></span></td>
            </tr>
        </table>
        <div class="line-full"></div>

        <div >
            <!-- TODO: mycard ? -->
            <button class="btnuseroper" onclick="">收藏的卡片</button>
            <button class="btnuseroper" onclick="">收藏的卡组</button>
            <button class="btnuseroper" onclick="">卡组构建</button>
        </div>

        <div class="line-full"></div>
        <p style="font-size: 1.2em;"><b>最近收藏</b></p>

        <div id="collected">
        <!-- TODO: recent collected -->
            <table style="border: none; width: 100%;">
                <tr style="height: 40px; border-bottom: 1px solid lightgray;">
                    <td style="width: 20%; height: 40px; vertical-align: center">[卡组]</td>
                    <td>aaaa</td>
                </tr>
                <tr style="height: 40px; border-bottom: 1px solid lightgray;">
                    <td style="width: 20%; height: 40px; vertical-align: center">[卡组]</td>
                    <td style="height: 40px; vertical-align: center">aaaa</td>
                </tr>
                <tr style="height: 40px; border-bottom: 1px solid lightgray;">
                    <td style="width: 20%; height: 40px; vertical-align: center">[卡组]</td>
                    <td>aaaa</td>
                </tr>

            </table>
        </div>

        <div class="line-full"></div>

        <div><button class="btnuserbottom" onclick="changeuserinfoDialog();">修改用户信息</button></div>
        <p></p>

        <div><button class="btnuserbottom" style="color: red;" onclick="logout();">登出帐号</button></div>

    </div>

</div>

<div id="login"></div>
<div id="register"></div>
<div id="resetpwd"></div>
<div id="changeinfo"></div>

<script type="text/javascript">
    $("#login").load("popup/login.html");
    $("#register").load("popup/register.html");
    $("#resetpwd").load("popup/resetpwd.html");
    $("#changeinfo").load("popup/changeinfo.html");
    getUserData();
</script>
</body>
</html>